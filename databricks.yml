# This is a Databricks asset bundle definition for the Smart Stock application.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: smart_stock

include:
  - resources/*.yml
  - resources/jobs/*.yml

# Exclude unnecessary files from sync
sync:
  exclude:
    - app/              # Databricks App (deployed separately)
    - client/           # Unused client folder at root
    - node_modules/
    - "*/node_modules/"
    - __pycache__/
    - "*/__pycache__/"
    - "*.pyc"
    - .git/
    - .github/
    - "*.md"
    - "*.lock"
    - build/
    - "*/build/"
    - dist/
    - .venv/
    - .env*
    - "*.log"

variables:
  catalog_name:
    description: The catalog name to use for the Smart Stock application.
  lakebase_instance_name:
    description: The name of the Lakebase instance to use for the Smart Stock application.
  dim_product_pipeline_id:
    description: Pipeline ID for dim_product sync
  dim_warehouse_pipeline_id:
    description: Pipeline ID for dim_warehouse sync
  fact_transactions_pipeline_id:
    description: Pipeline ID for fact_transactions sync
  inventory_historical_pipeline_id:
    description: Pipeline ID for inventory_historical sync
  inventory_forecast_pipeline_id:
    description: Pipeline ID for inventory_forecast sync

targets:
  dev:
    mode: development
    default: true
    variables:
      catalog_name: demo_nnguyen
      lakebase_instance_name: smartstock
      dim_product_pipeline_id: 8dd276d7-ddaf-48c1-905f-cd06ee3513e0
      dim_warehouse_pipeline_id: 0835f41e-4248-474c-802c-a8b892643d61
      fact_transactions_pipeline_id: 41a42b76-489f-486e-8aa7-755d80a41f1d
      inventory_historical_pipeline_id: bc27caff-b9bf-4af7-85d4-c7bbe178fa70
      inventory_forecast_pipeline_id: e69fb378-312a-4ec1-9765-03c6222c222d
    workspace:
      host: https://fe-vm-nam-nguyen-workspace-classic.cloud.databricks.com/
      # Note: For local dev, use --profile flag or set DATABRICKS_CONFIG_PROFILE env var
      # In CI/CD, DATABRICKS_HOST and DATABRICKS_TOKEN env vars are used

  prod:
    mode: production
    variables:
      catalog_name: manufacturing
      lakebase_instance_name: smartstock
      dim_product_pipeline_id: 8dd276d7-ddaf-48c1-905f-cd06ee3513e0
      dim_warehouse_pipeline_id: 0835f41e-4248-474c-802c-a8b892643d61
      fact_transactions_pipeline_id: 41a42b76-489f-486e-8aa7-755d80a41f1d
      inventory_historical_pipeline_id: bc27caff-b9bf-4af7-85d4-c7bbe178fa70
      inventory_forecast_pipeline_id: e69fb378-312a-4ec1-9765-03c6222c222d
    workspace:
      host: https://e2-demo-west.cloud.databricks.com/
      root_path: "/Workspace/Demo Assets/Manufacturing/SmartStock - Inventory Management/smartstock"
